<apex:page id="cc_pmt_PO_edit" controller="ccrz.cc_ctrl_pmt_PO_Edit" applyHtmlTag="false"
	docType="html-5.0" sidebar="false" showHeader="false" standardStylesheets="false">
	<!-- LEGACY BLOCK BEGIN -->
	<c:ifConfigValue config="ui.tmplver" value="classic" default="true">
		<script id="MyAccount-MyWalletPO-Desktop" type="text/template">
			<div class="myWalletPOOuterContainer">
				<h2 class="title">{{pageLabelMap 'MyWallet_EditPymtMtd'}}</h2>
				<div class="main_content_large_right_container">

					<div class="alert alert-error error_messages_section" style="display:none;"></div>

					<form id="editPOForm" action="" class="editPOForm" forceSSL="true">
						<fieldset>
							<legend>{{pageLabelMap 'MyWallet_EditPO'}}</legend>
							<div class="my_account_information">
								<div class="row displayName">
									<label><span class="poLabel Name fieldLabel">{{pageLabelMap 'MyWallet_NameOpt'}}</span>
										<input type="text" name="displayName" id="displayName" value="{{this.displayName}}" maxlength="50" />
									</label>
								</div>
								<div class="row accountNumber">
									<label><span class="poLabel Number fieldLabel">{{pageLabelMap 'MyWallet_PONum'}}</span>
										<input type="text" name="accountNumber" id="accountNumber" value="{{this.accountNumber}}" maxlength="50" />
									</label>
								</div>
								<div class="row actionButtons">
									<label><span class="poLabel SavePayment fieldLabel">{{pageLabelMap 'MyWallet_Enabled'}}</span>
										<input type="checkbox" name="isEnabled" id="isEnabled" {{#if this.isEnabled}}checked{{/if}} />
									</label>
								</div>
							</div>
						</fieldset>
						<br/>
						<p class="two_buttons">
							<div class="right">
								<input type="button" class='button cancelPO' id='cancelPO' value="{{pageLabelMap 'MyWallet_Cancel'}}" />
								<input type="button" class='button savePO' id="savePO" value="{{pageLabelMap 'MyWallet_SaveToWall'}}" />
							</div>
						</p>
						<br/>
					</form>
				</div>
			</div>
		</script>
	</c:ifConfigValue>
	<!-- END LEGACY BLOCK -->
	<!-- BEGIN BOOTSTRAP3 BLOCK -->
	<c:ifConfigValue config="ui.tmplver" value="boot3">
		<script id="MyAccount-MyWalletPO-Desktop" type="text/template">
			<div class="panel panel-default cc_panel cc_myaccount_mywallet">
				<div class="panel-heading cc_heading">
					<h3 class="panel-title cc_title">{{pageLabelMap 'MyWallet_EditPymtMtd'}}</h3>
				</div>
				<div class="cc_myaccount_content panel-body cc_body">
					<div class="error_messages_section" style="display:none;"></div>
					<form id="editPOForm" class="form-horizontal editPOForm cc_edit_po_form">
						<h4>{{pageLabelMap 'MyWallet_EditPO'}}</h4>
						<div class="form-group displayName">
							<label for="displayName" class="col-sm-2 control-label poLabel Name fieldLabel">{{pageLabelMap 'MyWallet_NameOpt'}}</label>
							<div class="col-sm-10">
								<input id="displayName" type="text" class="form-control" value="{{this.displayName}}" name="displayName" maxlength="50" />
							</div>
						</div>
						<div class="form-group accountNumber">
							<label for="accountNumber" class="col-sm-2 control-label poLabel Number fieldLabel">{{pageLabelMap 'MyWallet_PONum'}}</label>
							<div class="col-sm-10">
								<input id="accountNumber" type="text" class="form-control" name="accountNumber" value="{{this.accountNumber}}" maxlength="50" />
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-10">
								<div class="checkbox">
									<label for="isEnabled" class="poLabel SavePayment fieldLabel">
										<input type="checkbox" name="isEnabled" id="isEnabled" {{#if this.isEnabled}}checked{{/if}} />{{pageLabelMap 'MyWallet_Enabled'}}
									</label>
								</div>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-10">
								<input type="button" class='btn btn-default btn-sm button cancelPO cc_cancel_po' id="cancelPO" value="{{pageLabelMap 'MyWallet_Cancel'}}" />
								<input type="button" class='btn btn-default btn-sm button savePO cc_save_po' id="savePO" value="{{pageLabelMap 'MyWallet_SaveToWall'}}" />
							</div>
						</div>
					</form>
				</div>
			</div>
		</script>
	</c:ifConfigValue>
	<!-- END BOOTSTRAP3 BLOCK -->

<script>
	var storedPaymentId = "{!JSENCODE(storedPaymentId)}";
	var displayName = "{!JSENCODE(displayName)}";
	var accountNumber = "{!JSENCODE(accountNumber)}";
	var isEnabled = {!isEnabled};

	jQuery(function($) {
		CCRZ.models.StoredPaymentsPOModel = CCRZ.CloudCrazeModel.extend({
			className : "cc_ctrl_pmt_PO_Edit",
			updatePONumber: function(poData, callback) {
				var v = this;
				this.invokeCtx("updatePONumber", JSON.stringify(poData),
					function(response){
						if(response && response.success ) {
							console.log(response.data);
							callback();
						}
					}
				);
			},
		});

		CCRZ.views.StoredPaymentsPOView = CCRZ.CloudCrazeView.extend({
			viewName : "StoredPaymentsPOView",
			templateDesktop : CCRZ.util.template(CCRZ.uiProperties.StoredPaymentsPOView.desktop.tmpl),
			templatePhone : CCRZ.util.template(CCRZ.uiProperties.StoredPaymentsPOView.phone.tmpl),
			init : function(){
				this.render();
			},
			events: {
				"click #savePO" : "updatePONumber",
				"click #cancelPO" : "cancelNewPONumber"
			},
			initValidation : function() {
				$('#editPOForm').validate({
					invalidHandler : function(event, validator) {
						CCRZ.handleValidationErrors(event, validator, 'error_messages_section', false);
					},
					rules : {
						accountNumber : { required : CCRZ.getPageConfig('Pmt_PO.ReqNum', true) }
					},
					messages : {
						accountNumber : { required : CCRZ.pagevars.pageLabels['PMTPO_POReq']}
					},
					errorPlacement : function(error, element) { }
				});
			},
			preRender : function() {
				this.data={
					'storedPaymentId' : storedPaymentId,
					'displayName' : displayName,
					'accountNumber' : accountNumber,
					'isEnabled' : isEnabled
				};
			},
			renderDesktop : function(){				 
				this.setElement($(CCRZ.uiProperties.StoredPaymentsPOView.desktop.selector));
				this.$el.html(this.templateDesktop(this.data));
			},
			renderPhone : function(){
				this.setElement($(CCRZ.uiProperties.StoredPaymentsPOView.phone.selector));
				this.$el.html(this.templatePhone(this.data));
			},
			postRender : function() {
				this.initValidation();
			},
			cancelNewPONumber : function(){
				myWallet();
			},
			updatePONumber : function(event) {
				if ($('#editPOForm').valid()) {
					var formData = form2js("editPOForm", '.', false, function(node) {}, false);
					formData.storedPaymentId = this.data.storedPaymentId;
					formData.isEnabled = formData.isEnabled != null ? true : false;
					this.model.updatePONumber(formData, function() {
						myWallet();
					});
				}
			}
		});

		CCRZ.poView = new CCRZ.views.StoredPaymentsPOView({
			model : new CCRZ.models.StoredPaymentsPOModel
		});
	});
</script>	
</apex:page>