<apex:page id="pg" controller="ctrlReasonWizard" cache="false" tabstyle="Reason__c" sidebar="false" action="{!init}">
 <apex:includeScript value="{!URLFOR($Resource.Jquery_1_8_11, 'js/jquery-1.5.1.min.js')}" />
<style>
.treeview  li.expandable > span.unselectable { padding: 1px 0 1px 17px; display: block; background: url({!URLFOR($Resource.jQuery_treeview,'/jquery-treeview/images/folder-closed.gif')}) 0 0 no-repeat; }
.treeview  li.collapsable > span.unselectable { padding: 1px 0 1px 17px; display: block; background: url({!URLFOR($Resource.jQuery_treeview,'/jquery-treeview/images/folder.gif')}) 0 0 no-repeat; }
.treeview  span.selectable { padding: 1px 0 1px 17px; display: block; background: url(/img/icon/triangle16.png) 0 0 no-repeat; }
.treeview  .hover { color: #015BA7; cursor: pointer; }
.treeview  { background: #ffffff; }
</style>

<script>
function autoComplete_OnSelect(id, ev) {
    document.body.style.cursor='wait'; 
    //treat as a dblclick event (select and redirect to ancor)
    apexOnEvent(id, 'dblclick');
}
</script>


<apex:form >



<apex:sectionHeader title="Reason Selection Wizard" />

<apex:outputPanel rendered="{!!noAncorMode}" layout="none">
    <div class="ptBreadcrumb">&nbsp;&nbsp;<a href="/{!ancorObject.id}">Back to : {!ancorName}</a></div>
</apex:outputPanel>  


<apex:outputPanel id="debug" style="width:100%" rendered="{!$CurrentPage.parameters.debug='1'}">
        event: {!event}<br/>
        eventItem: {!eventItem}<br/>
</apex:outputPanel>   

<apex:outputPanel id="required" rendered="{!$CurrentPage.parameters.req='1'}">
    <apex:pageMessage summary="Reason is required for this record." severity="error" strength="3" />
<br/>
</apex:outputPanel>

<apex:pageMessages />

<apex:outputPanel id="ok" layout="none">

    <apex:actionFunction action="{!onEvent}" name="apexOnEvent" rerender="body,debug"  oncomplete="document.body.style.cursor='auto';" >
        <apex:param name="eventid" assignTo="{!eventItem}" value=""  />
        <apex:param name="event" assignTo="{!event}" value=""  />
    </apex:actionFunction>


     <table style="width:100%">
            <tr>
            <td style="width:350px;" valign="top">
                <apex:outputPanel id="selectors" style="width:350px">
                
                <apex:pageBlock mode="maindetail" >
              
                <apex:pageBlockSection title="AutoComplete" columns="1">
                    <c:autoComplete data="{!rootNode.JSON}" OnSelect="document.body.style.cursor='wait'; autoComplete_OnSelect" />
                </apex:pageBlockSection> 
            
                <apex:pageBlockSection title="Tree View Selection" columns="1">
                    <c:jqTree rootNode="{!rootNode}" showRoot="true" OnEvent="document.body.style.cursor='wait'; apexOnEvent"/> 
                </apex:pageBlockSection>
    
                </apex:pageBlock>
                </apex:outputPanel>
            </td>
            <td valign="top"> 
            
                <apex:outputPanel id="body" style="width:100%">
                
                <apex:pageMessages />
                <apex:variable var="SelectedObject" value="{!SelectedNode.record}" />
                <apex:pageBlock title="Selected Reason" >
                    <apex:pageBlockButtons location="both">
                        <apex:commandButton value="Add" action="{!Add}" rendered="{!SelectedObject['IsSelectable__c']}" />
                    </apex:pageBlockButtons>
                    <apex:pageBlockSection columns="2">
                            <apex:pageBlockSectionItem >
                            <apex:outputLabel value="{!$ObjectType.Reason__c.fields.name.label}" />
                            <apex:outputLink value="/{!SelectedObject.id}" id="theLink" target="_blank">{!SelectedObject['Name']}</apex:outputLink>
                            </apex:pageBlockSectionItem>
                            <apex:outputField value="{!SelectedObject['ReasonL1__c']}" />
                            <apex:outputField value="{!SelectedObject['ReasonL2__c']}" />
                            <apex:outputField value="{!SelectedObject['ReasonL3__c']}" />
                            <apex:outputField value="{!SelectedObject['ReasonL4__c']}" />
                    </apex:pageBlockSection>
                </apex:pageBlock>
                </apex:outputPanel>
                
            </td>
            </tr>
        </table>
</apex:outputPanel> 
 </apex:form>
        <br/>
        <br/>
        
</apex:page>