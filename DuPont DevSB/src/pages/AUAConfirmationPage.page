<!--
/******************************************************************************* 
Copyright © 2016 DuPont. All rights reserved. 
Author: Abhinav Bhatnagar
Email: abhinav.bhatnagar@dupont.com
Description:  Visualforce page for confirmation screen
********************************************************************************/
-->
<apex:page controller="AUAConfirmationPageHelper" id="pg" action="{!dmlOperation}">
    <Script>
       function backConfirm(){
        var confrm =	confirm("Are you sure you want to Return to the Review Screen?  Changes will be lost if all steps below have not been submitted.");
            if(confrm){
                 window.open("/apex/AUAReviewPage?scontrolCaching=1&id={!uarid}","_self");
            }
        }
    </Script>
    <div class="ptBreadcrumb">
        <apex:outputLink id="backConfirm" value="/apex/AUAReviewPage?scontrolCaching=1&id={!uarid}" onclick="backConfirm();return false;" >&nbsp;«&nbsp;Back to Review Page:&nbsp;
        </apex:outputLink>  
    </div> 
    <apex:form id="frm">      
        <apex:includescript value="../../soap/ajax/23.0/connection.js"/>   
        <style>
            .apexp .bPageBlock.apexDefaultPageBlock .pbBody .pbSubheader {
            border-top: 0;
            color: Black; 
            }
        </style>
        <apex:pageBlock title="Summary Report - Confirmation Screen">
            <apex:pagemessages id="msgPage"/>
            <apex:pageBlockSection title="Approved" id="pbsa" columns="1" collapsible="true">                
                <apex:outputpanel layout="block" id="tsop" >                      
                    <div align="middle">
                        <apex:commandButton action="{!save}" rendered="{!if(isApprovalDoneProp=='True',false,true)}" title="Submit" onclick="this.disabled=true;this.className = 'btnDisabled';" reRender="msgPage" value="Submit" disabled="{!dataOfApprovedUARDS.size=0}" />
                    </div>
                    <apex:pageBlockTable value="{!dataOfApprovedUARDS}" var="records" id="tspbt" > 
                        <!--section to display records in pageblocktable -->                
                        <apex:repeat value="{!columnLabels}" var="Field" id="tsr"  >                        
                            <apex:column value="{!records[Field.name]}"  >                                
                                <apex:facet name="header">                                                           
                                    <apex:outputLabel value="{!Field.label}"  id="Headers"/>
                                </apex:facet>                            
                            </apex:column>    
                        </apex:repeat>  
                    </apex:pageBlockTable>    
                    <apex:outputLabel rendered="{!dataOfApprovedUARDS.size=0}" value="There are no records selected to be approved."/>
                </apex:outputpanel>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="De-Activate (Please note: Email will be sent to DuPont employees only on click of 'Submit & Send Emails' button.)" id="pbsda" columns="1" collapsible="true">
                <apex:outputpanel layout="block" id="tsopd">                        
                    <div align="middle" name='sendMail'>
                        <apex:commandButton action="{!SendMail}" title="Submit & Send Emails" rendered="{!if(isMailSentProp=='True',false,true)}" onclick="this.disabled=true;this.className = 'btnDisabled';"  reRender="sendMail,msgPage" value="Submit & Send Emails"  disabled="{!dataOfDeActivateUARDS.size=0}"  />
                    </div>
                    <apex:pageBlockTable value="{!dataOfDeActivateUARDS}" var="records" id="tspbtd" > 
                        <!--section to display records in pageblocktable -->                
                        <apex:repeat value="{!columnLabels}" var="Field" id="tsrd"  >                        
                            <apex:column value="{!records[Field.name]}"  >                                
                                <apex:facet name="headerd">                                                           
                                    <apex:outputLabel value="{!Field.label}"  id="Headersd"/>
                                </apex:facet>                            
                            </apex:column>    
                        </apex:repeat>  
                    </apex:pageBlockTable>    
                    <apex:outputLabel rendered="{!dataOfDeActivateUARDS.size=0}" value="There are no records selected to be De-Activated."/>
                </apex:outputpanel>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Modify" id="pbsm" columns="1" collapsible="true">
                <apex:outputpanel layout="block" id="tsopm" >                      
                    <apex:pageBlockTable value="{!dataOfModifyUARDS}" var="records" id="tspbtm" > 
                        <apex:variable id="isRendered" rendered="true" value="{!1}" var="isRendered"/>
                        <!--section to display records in pageblocktable -->                
                        <apex:repeat value="{!columnLabels}" var="Field" id="tsrm"  >    
                            
                            <apex:column value="{!records[Field.name]}"  >                                
                                <apex:facet name="headerm">                                                           
                                    <apex:outputLabel value="{!Field.label}"  id="Headersm"/>
                                </apex:facet>                            
                            </apex:column>   
                            <apex:column rendered="{!If(Field.name=='User_Region__c',true,false)}" >  
                                <apex:repeat value="{!idsUARDRecordSFARCreated}" var="idUARDRecordSFARCreated" id="iduards">
                                    <apex:variable id="isRendered" rendered="true" value="{!if(idUARDRecordSFARCreated==records['Id'],0,isRendered)}" var="isRendered"/>
                                </apex:repeat>
                                <apex:commandButton rendered="{!if(isRendered==1,true,false)}" action="{!CreateSFAR}" title="Submit & Create SFAR" oncomplete="window.open({!SFARURL});"   onclick="this.style.visibility='hidden';"  reRender="msgPage" value="Submit & Create SFAR" >
                                    <apex:param name="paramrecid" value="{!records['Id']}" assignTo="{!createSFARForId}" />
                                </apex:commandButton> 
                                <apex:outputText id="sfarStatus" rendered="{!if(isRendered==1,false,true)}" value="SFAR Created" label="SFAR Created"></apex:outputText>
                                <apex:variable id="isRendered" rendered="true" value="{!1}" var="isRendered"/>                                
                                <apex:facet name="headermcb" >                                                           
                                    <apex:outputLabel value="Action" title="Action" id="Headersmcb" />
                                </apex:facet>
                            </apex:column>
                            
                        </apex:repeat>
                    </apex:pageBlockTable>
                    <apex:outputLabel rendered="{!dataOfModifyUARDS.size=0}" value="There are no records selected to be Modified."/>
                </apex:outputpanel>
            </apex:pageBlockSection>
        </apex:pageBlock>
    </apex:form>
</apex:page>